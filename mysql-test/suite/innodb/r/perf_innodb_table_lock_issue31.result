CREATE TABLE t1 (c1 INT PRIMARY KEY, c2 INT, c3 INT, key(c1));
BEGIN;
INSERT INTO t1 VALUES (1,2,3),(2,3,4),(3,4,5),(5,6,7),(6,7,8);
COMMIT;
BEGIN;
UPDATE t1 SET c3=c3+1 WHERE c1 = 2;
BEGIN;
UPDATE t1 SET c3=c3+1 WHERE c1 = 5;
BEGIN;
INSERT INTO t1 VALUES (7,8,9);
COMMIT;
COMMIT;
COMMIT;
BEGIN;
UPDATE t1 SET c3=c3+1 WHERE c1 = 1;
BEGIN;
INSERT  INTO t1 VALUES (8,9,10);
UPDATE t1 SET c3=c3+1 WHERE c1 = 2;
UPDATE t1 SET c3=c3+1 WHERE c1 = 6;
UPDATE t1 SET c3=c3+1 WHERE c1 = 1;;
UPDATE t1 SET c3=c3+1 WHERE c1 = 6;
ERROR 40001: Deadlock found when trying to get lock; try restarting transaction
COMMIT;
COMMIT;
BEGIN;
UPDATE t1 SET c3=c3+1 WHERE c1 = 2;
UPDATE t1 SET c3=c3+1 WHERE c1 = 2;;
COMMIT;
DROP TABLE t1;
CREATE TABLE t1 (a BLOB, b TEXT, PRIMARY KEY(a(1))) ENGINE=InnoDB;
INSERT INTO t1 VALUES(REPEAT('a',8000),REPEAT('b',8000));
UPDATE t1 SET a=REPEAT('a',7999);
DROP TABLE t1;
